Same as the last except a race condition is triggered to cause the null pointer dereference instead and there is a check so no buffer overflow happens.

```
static int tostring_close(struct inode *i, struct file *f)
{
  printk(KERN_INFO "Tostring: close()\n");
  printk("Tostring: Deleting stack\n");
  kfree(tostring->tostring_stack);
  tostring->tostring_stack=NULL;
  tostring->tostring_read=NULL;
  tostring->pointer=0;
  tostring->pointer_max=0;
  return 0;
}
```

Closing the device sets the  tostring->tostring_read pointer to read and then calling read() on the device derefences the null pointer.

Mmap some shellcode(equivalent to commit_creds(prepare_kernel_cred(0))) since there are no protections and you get root.
